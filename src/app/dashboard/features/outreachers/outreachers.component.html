<section class="min-h-[105vh] text-gray-600 dashboard-main-content">
  @if (store.isLoading()) {
    <div class="flex items-center justify-between mb-8">
      <div class="h-5 w-52 rounded-md bg-gray-200 animate-pulse"></div>
    </div>
    <div class="grid grid-cols-4 overflow-x-auto">
      @for (i of skeletonArray; track $index) {
        <div class="border-y border-gray-200 py-3 px-2">
          <div class="h-4 rounded-md bg-gray-200 animate-pulse mb-2"></div>
        </div>
      }
    </div>
  }
  @if (store.outreachers()?.[1] === 0) {
    <p>Aucun appel trouvé.</p>
  }
  @let outreachers = store.outreachers()?.[0];
  @if (outreachers && !store.isLoading()) {
    <p-table [size]="'small'" [value]="outreachers" [tableStyle]="{ 'min-width': '20rem' }">
      <ng-template #caption>
        <div class="flex items-center justify-between mb-8">
          <h5 class="text-lg font-bold">Liste des vulgarisateurs</h5>
          <button
            pButton
            class="w-1/5!"
            [outlined]="true"
            [size]="'small'"
            [loading]="downloadStore.isLoading()"
            [disabled]="downloadStore.isLoading()"
            (click)="downloadOutreachers()">
            @if (!downloadStore.isLoading()) {
              <i-lucide [name]="icons.download" class="size-4" />
            }
            Télécharger CSV
          </button>
        </div>
      </ng-template>
      <ng-template #header>
        <tr>
          <th>Image</th>
          <th>Nom</th>
          <th>Email</th>
          <th>Stats</th>
        </tr>
      </ng-template>
      <ng-template #body let-outreacher>
        <tr>
          <td>
            <p-avatar [image]="outreacher | apiIMG: 'user'" />
          </td>
          <td>{{ outreacher.name | titlecase | slice: 0 : 20 }}</td>
          <td>{{ outreacher.email }}</td>
          <td class="py-3">{{ outreacher.outreachCount }}</td>
        </tr>
      </ng-template>
      <ng-template #footer>
        @if ((store.outreachers()?.[1] || 0) > 30) {
          <tr>
            <td colspan="5" class="text-center text-sm">
              <div class="card flex justify-center text-center text-sm mt-2">
                <p-paginator
                  (onPageChange)="onPageChange($event)"
                  [first]="queryParams().page ? ((queryParams().page || 0) - 1) * 40 : 0"
                  [rows]="40"
                  [pageLinkSize]="5"
                  [showCurrentPageReport]="true"
                  [currentPageReportTemplate]="'{currentPage} sur {totalPages}'"
                  [totalRecords]="store.outreachers()?.[1]" />
              </div>
            </td>
          </tr>
        }
      </ng-template>
    </p-table>
  }
</section>
